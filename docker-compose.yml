services:
    auth:
        image: quay.io/keycloak/keycloak:22.0.0
        profiles:
            - default
            - dev
        environment:
            KEYCLOAK_ADMIN: admin 
            KEYCLOAK_ADMIN_PASSWORD: admin
        command:
            - start-dev
            - --import-realm
        ports:
            - 8080:8080
        networks:
            - nginx-network
        volumes:
            - ./auth/realm.json:/opt/keycloak/data/import/realm.json
        container_name: uc-pact-auth
    frontend:
        build:
            context: uc-pact-webapp
            dockerfile: ../frontend.Dockerfile
        profiles:
            - default
        ports:
            - 80:80
        networks:
            - nginx-network
        volumes:
            - ${PWD}/nginx.conf:/etc/nginx/conf.d/default.conf
        container_name: uc-pact-webapp
    frontend-dev:
        build:
            context: uc-pact-webapp
            dockerfile: ../frontend-dev.Dockerfile
        profiles:
            - dev
        ports:
            - 80:3000
            - 3000:3000
        networks:
            - nginx-network
        volumes:
            - ./uc-pact-webapp/public:/webapp-build/public
            - ./uc-pact-webapp/src:/webapp-build/src
        container_name: uc-pact-webapp-dev
    frontend-tests:
        build:
            context: uc-pact-webapp
            dockerfile: ../frontend-tests.Dockerfile
        profiles:
            - tests
        ports:
            - 80:3000
            - 3000:3000
        networks:
            - nginx-network
        volumes:
            - ./uc-pact-webapp/public:/webapp-build/public
            - ./uc-pact-webapp/src:/webapp-build/src
        container_name: uc-pact-webapp-tests
    backend:
        build:
            context: uc-pact-backend-flat
            dockerfile: ../backend.Dockerfile
        profiles:
            - default
        environment:
            KC_PUBLIC_KEY_URI: http://auth:8080/realms/UCPACT-Realm/
            KC_HTTP_RELATIVE_PATH: true
            MODEL_VERSION: "1.0"
        networks:
            - nginx-network
        volumes:
            - ./models:/app/models
        container_name: uc-pact-backend-flat
    backend-dev:
        build:
            context: uc-pact-backend-flat
            dockerfile: ../backend.Dockerfile
        profiles:
            - dev
        ports:
            - 5000:5000
        environment:
            KC_PUBLIC_KEY_URI: http://auth:8080/realms/UCPACT-Realm/
            KC_HTTP_RELATIVE_PATH: true
            MODEL_VERSION: "1.0"
        networks:
            - nginx-network
        volumes:
            - ./models:/app/models
        container_name: uc-pact-backend-flat-dev
volumes:
    realm.json:
    nginx.conf:
    models:
    src:
networks:
    nginx-network:
        name: nginx-network
